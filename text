import json
import requests
from google.oauth2.service_account import Credentials
import gspread

API_URL = "https://backend-secure-cred-api.onrender.com/get-credentials"
API_TOKEN = "a2htZW5odWFrdXltYWV5ZWQ="

def connect_gsheet():
    headers = {"X-API-Token": API_TOKEN}
    response = requests.get(API_URL, headers=headers)
    response.raise_for_status()

    creds_json = response.json()  # ดึงเป็น dict จาก JSON response

    creds = Credentials.from_service_account_info(creds_json, scopes=[
        "https://spreadsheets.google.com/feeds",
        "https://www.googleapis.com/auth/drive"
    ])

    client = gspread.authorize(creds)
    sheet = client.open_by_key("1rQnV_-30tmb8oYj7g9q6-YdyuWZZ2c8sZ2xH7pqszVk")
    return sheet
